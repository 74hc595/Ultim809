#!/usr/bin/env ruby
#
# map2inc
# Reads globals defined in a .map file (generated by aslink)
# and produces an include file
#
# usage: map2inc <infile.map> [outfile.inc]
#
# Matt Sarnoff (msarnoff.org/6809)
# June 28, 2010

infile = ARGV[0]
if not infile then
	puts "usage: map2inc <infile.map> [outfile.inc]"
	exit
end

outfile = ""
if ARGV[1] then
	outfile = ARGV[1]
else
	outfile = File.basename(infile,".map") + ".inc"
end

File.open(outfile, 'w') {|f|
	IO.readlines(infile).each { |l|
		if matches = l.match(/^ {10}([0-9A-Fa-f]{4})\s+([0-9A-Z_]+)/) then
			f.write matches[2] + " .gblequ 0x" + matches[1] + "\n"
		end
	}
}
